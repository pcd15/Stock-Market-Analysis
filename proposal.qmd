---
title: "Project title"
subtitle: "Proposal"
format: html
editor: visual
---

```{r}
#| label: load-pkgs
#| message: false

library(tidyverse)
library(lubridate)
```

# Data 1

## Introduction and data

Data set 1 comes from 3 sources. Data on federal funds rate was scraped from Macrotrends, which collected the data from the World Bank's "country management units and data obtained from official sources." Data on inflation rate was also scraped from Macrotrends, which collected the data from World Bank's "country management units and data obtained from official sources." Data on S&P 500 total returns was scraped from Slickcharts. The data was collected by calculating the total returns of the S&P 500 index, which is equal to the change in stock prices from the beginning to the end of the year and dividends, and dividing that return by the initial amount paid for the stock. The data for dividends was collected from stock-market exchange records or organizations like Yahoo Finance that process such data. While the data shows heavy fluctuations, we see that federal funds and inflation rate both peaked around 1980.

## Research question

-   A well formulated research question. (You may include more than one research question if you want to receive feedback on different ideas for your project. However, one per data set is required.)
-   A description of the research topic along with a concise statement of your hypotheses on this topic.
-   Statement on why this question is important.
-   Identify the types of variables in your research question. Categorical? Quantitative?

## Glimpse of data

```{r warning = FALSE, message = FALSE}
#| label: load-data-1

fed_funds_rate <- read_csv("data/fed-funds-rate-historical-chart.csv")
inflation_rate <- read_csv("data/united-states-inflation-rate-cpi.csv")
sp500_year <- read_csv("data/history.csv")
```

```{r warning = FALSE}
#|: fixing-and-combining-data-sets

names(fed_funds_rate)[1] <- "day"
names(inflation_rate)[1] <- "year"

fed_funds_rate <- fed_funds_rate |>
  slice(9:nrow(fed_funds_rate)) |>
  separate(day, into = c("day", "fed_funds_rate"), sep = ",")

fed_funds_rate

fed_funds_rate<- fed_funds_rate|>
  mutate(day = substring(day, 1, 4))|>
  rename(year = day) |>
  group_by(year) |>
  summarize(mean_fed_funds_rate = mean(as.numeric(fed_funds_rate)))
  
inflation_rate <- inflation_rate |>
  slice(11:nrow(inflation_rate)) |>
  separate(year, into = c("year", "inflation_rate", "inflation_annual_change"), sep = ",")

inflation_rate <- na.omit(inflation_rate)

inflation_rate<- inflation_rate|>
  mutate(year = substring(year, 1, 4))

historicaldata <- inner_join(inflation_rate, fed_funds_rate)
# historicaldata <- inner_join(historicaldata, sp500_year)


view(fed_funds_rate)
view(inflation_rate)
view(sp500_year)

glimpse(fed_funds_rate)
glimpse(inflation_rate)
glimpse(sp500_year)
```

# Data 2

## Introduction and data

-   The source of the data is the Wall Street Journal, who gets their live data from FactSet. The data is collected daily (well really, every second) and it is collected by monitoring various operations done in the stock market, which lead to increases and decreases in prices (which are then ultimately collected). The observations show heavy fluctuation of course as expected with something as volatile as the stock market, but this year, a general decline in share prices (which could partially be attributed to inflation and interest rates).

## Research question

-   With the highest inflation rates ever seen, traders and those who work in the financial industry are even more unsure about how to go about trading in the stock market. Of course it is difficult to ever predict the market, but even more so in times like this. With this dataset, we would like to address the following question: how have high inflation rates and interest rates impacted the S&P 500 this year? And how does this compare to the amount of stock rises/falls when inflation rates were previously high? This question is important as people want to know that when they invest in something, generally their money is safe. In times like these, it's hard to say when it is actually safe to invest in something, and so we want to delve deeper into when you might actually want to be bullish or bearish in times like these. Our hypothesis is the following: While the stock market will fall as inflation rates rise (which are followed by interest rates as well), there are good times to invest even with the problematic circumstances. Our variables are mostly quantitative, analyzing interest rates, inflation rates, stock price rise and falls, while the categorical variable is whether or not there was a net gain or loss (categorized by TRUE if gain and FALSE if not) on the day.

## Glimpse of data

```{r message = FALSE}
#| label: load-data-2

sp500_current <- read_csv("data/HistoricalPrices.csv")
glimpse(sp500_current)

sp500_curr_updated <- sp500_current |>
mutate(
	daily_diff = Close - Open,
	high_minus_low = High - Low,
  daily_percent_change = ((Close - Open) / Open) * 100,
	gain = daily_diff > 0
)

```

# Data 3

## Introduction and data

-   Identify the source of the data.

-   State when and how it was originally collected (by the original data curator, not necessarily how you found the data).

-   Write a brief description of the observations.

-   Address ethical concerns, if any.

## Research question

-   A well formulated research question. (You may include more than one research question if you want to receive feedback on different ideas for your project. However, one per data set is required.)
-   A description of the research topic along with a concise statement of your hypotheses on this topic.
-   Statement on why this question is important.
-   Identify the types of variables in your research question. Categorical? Quantitative?

## Glimpse of data

```{r message = FALSE}
#| label: load-data-3

sp500_by_company <- read_csv("data/sp500_by_company.csv")
sp500_by_sector <- read_csv("data/constituents_csv.csv")
glimpse(sp500_by_company)
glimpse(sp500_by_sector)
```

```{r}
#|: combining-data-set
# sp500_by_company was created by joining two scraped data frames

sp500_by_sector <- sp500_by_sector |>
  mutate(
    symbol = Symbol,
    name = Name,
    sector = Sector
  ) |>
  select(symbol, name, sector)

sp500_by_company_and_sector <- sp500_by_company |>
  left_join(sectors, by = "symbol") |>
  relocate(name) |>
  select(name, symbol, weight, current_price, ytd_return, sector)
```

```{r warning = FALSE}
#|: fixing-NAs-and-adding-vars

sp500_by_company_and_sector <- sp500_by_company_and_sector |>
  mutate(
    ytd_return_num = str_remove(ytd_return, "%"),
    ytd_return_num = as.numeric(ytd_return_num),
    current_price = str_trim(current_price),
    current_price = as.numeric(current_price),
    return_category = if_else(ytd_return_num > 0, "positive", "negative"),
    ytd_factor =  (ytd_return_num + 100) / 100,
    original_price = current_price / ytd_factor, 
    name = case_when(
      symbol == "MOH" ~ "Molina Healthcare",
      symbol == "EPAM" ~ "EPAM Systems",
      symbol == "ELV" ~ "Elevance Health",
      symbol == "KDP" ~ "Keurig Dr Pepper",
      symbol == "VICI" ~ "Vici Properties",
      symbol == "META" ~ "Meta Platforms",
      symbol == "CSGP" ~ "CoStar Group",
      symbol == "WBD" ~ "Warner Bros Discovery",
      symbol == "CEG" ~ "Constellation Energy",
      symbol == "ON" ~ "ON Semiconductor",
      symbol == "WTW" ~ "Willis Towers Watson",
      symbol == "PCG" ~ "PG&E",
      symbol == "INVH" ~ "Invitation Homes",
      symbol == "BALL" ~ "Ball",
      symbol == "FDS" ~ "FactSet Research Systems",
      symbol == "EQT" ~ "EQT",
      symbol == "TRGP" ~ "Targa Resources",
      symbol == "CPT" ~ "Camden Property Trust",
      symbol == "NDSN" ~ "Nordson",
      symbol == "SEDG" ~ "Solaredge Technologies",
      symbol == "PARA" ~ "Paramount Global Class B",
      symbol == "SBNY" ~ "Signature Bank",
      TRUE ~ name
    ),
    sector = case_when(
      symbol == "MOH" ~ "Health Care",
      symbol == "EPAM" ~ "Information Technology",
      symbol == "ELV" ~ "Health Care",
      symbol == "KDP" ~ "Consumer Staples",
      symbol == "VICI" ~ "Real Estate",
      symbol == "META" ~ "Communication Services",
      symbol == "CSGP" ~ "Real Estate",
      symbol == "WBD" ~ "Communication Services",
      symbol == "CEG" ~ "Utilities",
      symbol == "ON" ~ "Materials",
      symbol == "WTW" ~ "Communication Services",
      symbol == "PCG" ~ "Energy",
      symbol == "INVH" ~ "Real Estate",
      symbol == "BALL" ~ "Materials",
      symbol == "FDS" ~ "Information Technology",
      symbol == "EQT" ~ "Utilities",
      symbol == "TRGP" ~ "Utilities",
      symbol == "CPT" ~ "Real Estate",
      symbol == "NDSN" ~ "Industrials",
      symbol == "SEDG" ~ "Materials",
      symbol == "PARA" ~ "Communication Services",
      symbol == "SBNY" ~ "Financials",
      TRUE ~ sector
    )
  ) |>
  select(
    name, symbol, weight, original_price, 
    current_price, ytd_return, sector, return_category
  )

glimpse(sp500_by_company_and_sector)
```
